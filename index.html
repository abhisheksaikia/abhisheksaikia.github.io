<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title></title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.15.0/mapbox-gl.js'></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.15.0/mapbox-gl.css' rel='stylesheet' />
    <style>
        body { margin:0; padding:0; }
        #map { position:absolute; top:0; bottom:0; width:100%; }
    </style>
</head>
<body>
 
 <style>
    #fit {
        display: block;
        position: relative;
        margin: 0px auto;
        width: 30%;
        height: 40px;
        padding: 5px;
        border: none;
        border-radius: 3px;
        font-size: 12px;
        text-align: center;
        color: #fff;
        background: #000000;
    }
    #fly {
        display: block;
        position: relative;
        margin: 0px auto;
        width: 30%;
        height: 40px;
        padding: 5px;
        border: none;
        border-radius: 3px;
        font-size: 12px;
        text-align: center;
        color: #fff;
        background: #000000;
    }
   
</style>
<script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v1.0.0/mapbox-gl-geocoder.js'></script>
<link rel='stylesheet' href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v1.0.0/mapbox-gl-geocoder.css' type='text/css' />


<div id='map'></div>

<br/>
 


<button onclick='fit();' id='fit'>Fit to Indian Subcontinent</button>
<button onclick='fly();' id='fly'>Fly</button>



<script>
mapboxgl.accessToken = 'pk.eyJ1Ijoic2Fpa2lhLWFiaGlzaGVrOCIsImEiOiJjaWtxbnF5MG8wMHVidTdra2J5MXJyMWVvIn0.yPOouitYbzDGHY1BpBZ0GQ';
var map = new mapboxgl.Map({
    container: 'map', // container id
    style: 'mapbox://styles/saikia-abhishek8/cilx9nldz007pbkkk2ze5lkr7', //stylesheet location
    center: [77.60,12.97], // starting position
    //pitch:75,
    zoom: 12 // starting zoom
});
function fit() {
    map.fitBounds([[
         68.027344,
         5.3757834
     ], [
         97.382813,
        35.550420
    ]]);
     } 
     function fly() {
//  Fly to a random location by offsetting the point -74.50, 40
//     // by up to 5 degrees.
    map.flyTo({
center: [
   77.60 + (Math.random() - 0.1) * 10,
          12.97 + (Math.random() - 0.1) * 10]
     });
 }
map.addControl(new mapboxgl.Geocoder());
var geojson = {
    'type': 'FeatureCollection',
    'features': []
};
var url = "http://earthquake.usgs.gov/fdsnws/event/1/query?format=geojson&starttime=2014-01-01&endtime=2014-01-02";
        $.ajax({
            url: url,
        }).done(function (data) {
            console.log(data);
            data.elements.forEach(function (element) {
                console.log(element.tags.name);
                var point = {
                    'type': 'Feature',
                    'geometry': {
                        'type': 'Point',
                        'coordinates': [element.lon, element.lat]
                    },
                    'properties': {
                        "title":element.tags.name,
                       
                       }
                };
                geojson.features.push(point);
            });
            // console.log(geojson);
                
                map.addSource("overpassMarkers", {
                    "type": "geojson",
                    "data": geojson
                });
            map.addLayer({
                    "id": "markersOuter",
                    "source": "overpassMarkers",
                    "type": "circle",
                    'interactive': true,
                    "paint": {
                        "circle-radius": 10,
                        "circle-color": "#000000",
                        "circle-opacity":1,
                    }
                })
                map.addLayer({
                    "id": "markersInner",
                    "source": "overpassMarkers",
                    "type": "circle",
                    'interactive': true,
                    "paint": {
                        "circle-radius": 5,
                        "circle-color": "#df739e",
                        "circle-opacity":1, 
                    }
                })
 
        });
map.on('click', function (e) {
   
   
    map.featuresAt(e.point, {
        radius: 10,
        layer: ['markersInner', 'markersOuter'],
        includeGeometry: true},  function (err, features) {
            console.log(features.length);
            if (err) throw err;
                if (features.length > 0) {
                    
                    var popupHTML = features[0].properties.title;
                    var popup = new mapboxgl.Popup()
                                .setLngLat(features[0].geometry.coordinates)
                                .setHTML(popupHTML)
                                .addTo(map);
                            }
                        });
});
     
</script>
</body>
</html>